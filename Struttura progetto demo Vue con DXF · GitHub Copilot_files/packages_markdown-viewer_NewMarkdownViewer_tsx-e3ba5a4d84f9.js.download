"use strict";(globalThis.webpackChunk_github_ui_github_ui=globalThis.webpackChunk_github_ui_github_ui||[]).push([["packages_markdown-viewer_NewMarkdownViewer_tsx"],{39837:(e,t,s)=>{s.d(t,{A:()=>W});var i=s(74848),n=s(69726),l=s(96540),a=s(73017),r=s(40961),o=s(87670);let d={"task-list-item":"TaskListItems-module__task-list-item--wcmow","numbered-task-list":"TaskListItems-module__numbered-task-list--qipBK","numbered-task-list-nested":"TaskListItems-module__numbered-task-list-nested--sSUYp","unordered-task-list":"TaskListItems-module__unordered-task-list--Sl3h1","unordered-task-list-nested":"TaskListItems-module__unordered-task-list-nested--Eju8Y","bullet-task-item":"TaskListItems-module__bullet-task-item--X_OYA","numbered-task-item":"TaskListItems-module__numbered-task-item--rZ83B","nested-overlay-list":"TaskListItems-module__nested-overlay-list--A36Te","overlay-task-list-child":"TaskListItems-module__overlay-task-list-child--Phee9"};var m=s(46720),c=s(20263),u=s(80752);let h=e=>"string"==typeof e?.taskBox&&e?.text?.match(/[^\s\\]/)!==null,k=({container:e,nestedItems:t,globalIndex:s,markdownIndex:i,items:n,itemsData:l,nested:a=!1,lists:r,parentIsChecklist:o,hasDifferentListTypes:d})=>(n.map((n,m)=>{let c=Array.from(n.querySelectorAll(":scope > ul > li:not(.base-task-list-item), :scope > ol > li:not(.base-task-list-item)"))??[],u=Array.from(n.querySelectorAll(":scope > ul > li.task-list-item, :scope > ol > li.task-list-item"))??[],h=(Array.from(n.querySelectorAll("ul > li.task-list-item, ol > li.task-list-item, li.task-list-item"))??[]).length,g=[];h>0&&t.set(s.toString(),h);let p=n.classList.contains("task-list-item")?function(e,t){let s=t.parentElement?.closest(".contains-task-list");if(!s)throw Error("Could not find the item's parent list");let i=t?Array.from(s.children).indexOf(t):-1;return[e.indexOf(s),i]}(r,n):void 0,{title:f,content:x}=function(e){let t="",s="";for(let n of e.childNodes){var i;if("INPUT"===(i=n).nodeName||"UL"===i.nodeName||"OL"===i.nodeName||"#comment"===n.nodeName)continue;let e=n.textContent||"";if("#text"===n.nodeName){t+=e,s+=e;continue}if("CODE"===n.nodeName){t+=`\`${e}\``,s+=n.outerHTML;continue}t+=e,s+=n.outerHTML}return{title:t.trim(),content:s}}(n);l.push({id:s.toString(),index:m,title:f,content:x,checked:n.querySelector(".task-list-item-checkbox")?.checked===!0,position:p,container:n.parentElement,nested:a,children:g,markdownIndex:n.classList.contains("task-list-item")?i+=1:-1,isBullet:n.parentElement?.tagName==="UL"&&!n.classList.contains("task-list-item"),isNumbered:n.parentElement?.tagName==="OL"&&!n.classList.contains("task-list-item"),parentIsChecklist:o,hasNestedItems:h>0,hasDifferentListTypes:d});let I=c.length>0&&k({container:e,nestedItems:t,globalIndex:s+1,markdownIndex:i,items:c,itemsData:g,nested:!0,lists:r,parentIsChecklist:n.classList.contains("task-list-item"),hasDifferentListTypes:u.length>0&&c.length!==u.length});s=I?I.globalIndex:s+1,i=I?I.markdownIndex:i}),{globalIndex:s,markdownIndex:i}),g=async({markdownValue:e,markdownIndex:t,onChange:s})=>{let i=e.split(/\r?\n/),n=null,l=!1;for(let e=0,a=0;e<i.length;e++){let r=i[e];if(r.trim().startsWith("\x3c!--")&&(l=!0),l){r.trim().endsWith("--\x3e")&&(l=!1);continue}if(n){if(x(r,n)){n=null;continue}}else n=f(r);if(n)continue;let o=(0,u.VB)(r);if(h(o)){if(a===t){let t=(0,u.a1)(p(o));i.splice(e,1,t);let n=i.join(`
`);return await s(n)}a++}}},p=e=>({...e,taskBox:"[ ]"===e.taskBox?"[x]":"[ ]"}),f=e=>{let t=e.match(/^ {0,3}(`{3,}|~{3,})[^`]*$/);return t?t[1]:null},x=(e,t)=>RegExp(`^ {0,3}${t}${t[0]}* *$`).test(e),I={"task-list-item":"TaskListItem-module__task-list-item--cjTUf",disabled:"TaskListItem-module__disabled--OHcK5","no-convert-task-list-item":"TaskListItem-module__no-convert-task-list-item--LET1o","left-aligned-content":"TaskListItem-module__left-aligned-content--xZ735","checkbox-items":"TaskListItem-module__checkbox-items--pIbRT","drag-drop-container":"TaskListItem-module__drag-drop-container--oJzzq","drag-handle-icon":"TaskListItem-module__drag-handle-icon--pdSL7","show-trigger":"TaskListItem-module__show-trigger--HU0ll","task-list-html":"TaskListItem-module__task-list-html--dnlap",taskStatusCheckbox:"TaskListItem-module__taskStatusCheckbox--FJC87",TaskListItemActionsContainer:"TaskListItem-module__TaskListItemActionsContainer--Bm18Z"};var b=s(27042),L=s(26108),T=s(5524),v=s(38621);let y={convertToIssue:"Convert to issue",convertToSubIssue:"Convert to sub-issue",moveUp:"Move up",moveDown:"Move down",openTaskOptions:e=>`Open ${e} task options`},N={TaskListMenuTriggerButton:"TaskListMenu-module__TaskListMenuTriggerButton--Qskh6"},_=({totalItems:e,onConvertToIssue:t,onConvertToSubIssue:s,item:n,allowIssueConversion:a,allowSubIssueConversion:r,disabled:d,setIsConverting:m,allowReordering:c,...u})=>{let{title:h,index:k,id:g}=n,{moveToPosition:p}=(0,o.gY)(),[f,x]=(0,l.useState)(!1),I=(0,l.useMemo)(()=>`task-list-menu-item-${g}`,[g]),_=e=>{if(e){let e=Array.from(document.querySelectorAll('[id^="task-list-menu-item-"]'));if(e.length>0){let t=e[Math.min(k,e.length-1)];t?.focus()}}else{let e=document.getElementById(I);e&&e.focus()}},w=({moveAction:e,e:t})=>{switch(t.preventDefault(),t.stopPropagation(),x(!1),e){case"up":p(k,k-1,!0);break;case"down":p(k,k+1,!1)}},j=({e,move:i,convertToIssue:l,convertToSubIssue:a})=>{e.preventDefault(),e.stopPropagation(),"Enter"===e.code&&i&&w({moveAction:i,e}),"Enter"===e.code&&l&&(x(!1),t?.(n,m,()=>{_(!1)})),"Enter"===e.code&&a&&(x(!1),s?.(n,m,()=>{_(!0)})),"Escape"===e.code&&x(!1)};return(0,i.jsxs)(b.W,{open:f,onOpenChange:x,children:[(0,i.jsx)(b.W.Anchor,{id:I,children:(0,i.jsx)(L.K,{"data-testid":u["data-testid"],icon:v.KebabHorizontalIcon,variant:"invisible","aria-label":y.openTaskOptions(h),disabled:d,className:N.TaskListMenuTriggerButton})}),(0,i.jsx)(b.W.Overlay,{children:(0,i.jsxs)(T.l,{children:[c&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(T.l.Item,{onClick:e=>w({moveAction:"up",e}),onKeyDown:e=>j({e,move:"up"}),disabled:0===k,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(v.ChevronUpIcon,{})}),y.moveUp]}),(0,i.jsxs)(T.l.Item,{onClick:e=>w({moveAction:"down",e}),onKeyDown:e=>j({e,move:"down"}),disabled:k===e-1,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(v.ChevronDownIcon,{})}),y.moveDown]})]}),a&&t&&(0,i.jsxs)(T.l.Item,{onClick:()=>t?.(n,m),onKeyDown:e=>j({e,convertToIssue:!0}),"data-testid":u["data-testid"]&&`${u["data-testid"]}-convert`,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(v.IssueOpenedIcon,{})}),y.convertToIssue]}),r&&s&&(0,i.jsxs)(T.l.Item,{onClick:()=>s?.(n,m),onKeyDown:e=>j({e,convertToSubIssue:!0}),"data-testid":u["data-testid"]&&`${u["data-testid"]}-convert-sub-issue`,children:[(0,i.jsx)(T.l.LeadingVisual,{children:(0,i.jsx)(v.IssueTracksIcon,{})}),y.convertToSubIssue]})]})})]})};try{_.displayName||(_.displayName="TaskListMenu")}catch{}let w={ADD_TAGS:["math-renderer"],ADD_ATTR:["style","data-run-id","data-catalyst","class"]},j=/\/issues\/\d*\d/,C=(e,t)=>{let s=document.createElement("div");s.innerHTML=e;let i=s.querySelectorAll("span.reference");if(0===i.length)return!0;if(t||i.length>1)return!1;let n=i[0];return n.remove(),""===s.innerHTML.trim()&&!!j.test(n.innerHTML)};function S({markdownValue:e,onChange:t,onConvertToIssue:s,onConvertToSubIssue:a,nested:r=!1,position:d=1,item:u,totalItems:h,disabled:k,hideActions:p,itemIdToFocus:f,setitemIdToFocus:x,toggledItem:b,setToggledItem:L}){let[T,v]=(0,l.useState)(u.checked),[y,N]=(0,l.useState)(!1),[j,S]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(f&&!k){let e=document.getElementById(`task-list-menu-item-${f}`);e&&e.focus(),x?.(null)}},[f,k,x]),(0,l.useEffect)(()=>{b&&!k&&L(null)},[b,k,L]);let $=(0,l.useCallback)(e=>{v(!u.checked),L(u.id),g({markdownValue:e,markdownIndex:u.markdownIndex,onChange:t})},[u,t,L]),A=!r&&!u.hasDifferentListTypes||r&&d<2&&!u.parentIsChecklist&&!u.hasDifferentListTypes,[D,B]=(0,l.useMemo)(()=>[C(u.content,!0),C(u.content,!1)],[u.content]),M=`tasklist-item-${d}-${u.markdownIndex}`,O=!r||s&&a?I["task-list-item"]:I["no-convert-task-list-item"];return O+=` ${r&&h>0?"contains-task-list":""}`,O+=k?` ${I.disabled}`:"",(0,i.jsxs)("div",{className:O,onMouseEnter:()=>N(!0),onMouseLeave:()=>N(!1),"data-testid":M,children:[(0,i.jsxs)("div",{className:I["left-aligned-content"],children:[(0,i.jsx)("div",{className:I["drag-drop-container"],children:A&&!k&&(0,i.jsx)(o.BS.DragTrigger,{className:`${I["drag-handle-icon"]} ${y?I["show-trigger"]:""}`,style:{width:"20px",height:"28px"}})}),(0,i.jsxs)("div",{className:I["checkbox-items"],id:`checkbox-item-${u.id}`,children:[(0,i.jsx)(m.A,{autoFocus:u.id===b,checked:T,disabled:k,onChange:t=>{t.preventDefault(),t.stopPropagation(),$(e)},"aria-label":`${u.title} checklist item`,className:I.taskStatusCheckbox}),(0,i.jsx)(c.JU,{html:u.content,className:I["task-list-html"],domPurifyConfig:w})]})]}),(0,i.jsxs)("div",{className:I.TaskListItemActionsContainer,children:[j&&(0,i.jsx)(n.A,{size:"small"}),!p&&A&&u.position&&!j&&(0,i.jsx)(_,{"data-testid":`${M}-menu`,onConvertToIssue:s,onConvertToSubIssue:a,totalItems:h,item:u,disabled:k,allowIssueConversion:D,allowSubIssueConversion:B,setIsConverting:S,allowReordering:A})]})]})}try{S.displayName||(S.displayName="TaskListItem")}catch{}let $={ListItemContent:"ListItem-module__ListItemContent--QTxoX"};function A({item:e,position:t}){let s=`tasklist-item-${t}-${e.markdownIndex}`;return(0,i.jsx)(c.Pk,{html:e.content,as:"div","data-testid":s,className:$.ListItemContent})}try{A.displayName||(A.displayName="ListItem")}catch{}let D=(e,t)=>{let s,i=t.split(/\r?\n/),n=-1,l=-1,a=-1;for(let[t,r]of i.entries()){let i=(0,u.VB)(r),o=i?.leadingWhitespace.length;if(s&&(!r||void 0!==o&&o<=s.leadingWhitespace.length)){l=t>0?t-1:0;break}i&&h(i)&&++a===e&&(n=t,s=i)}return{startLineNumber:n,endLineNumber:l=-1===l?i.length-1:l}},B=({tasklists:e,markdownValue:t,externalOnChange:s,onConvertToIssue:n,onConvertToSubIssue:a,tasklistData:m,setTasklistData:c,disabled:u,viewerCanUpdate:h})=>{let[k,g]=(0,l.useState)(!1),[p,f]=(0,l.useState)(null),[x,I]=(0,l.useState)(null),b=(0,l.useCallback)(async({dragMetadata:e,dropMetadata:i,isBefore:n,items:l,container:a})=>{if(e.id===i?.id||u)return;g(!0);let r=l.find(t=>t.id===e.id)?.markdownIndex,o=l.find(e=>e.id===i.id)?.markdownIndex;if(void 0===r||void 0===o)return;let d=((e,t,s,i)=>{let{startLineNumber:n,endLineNumber:l}=D(s,e),{startLineNumber:a,endLineNumber:r}=D(i,e),o=e.split(/\r?\n/),d=l-n+1,m=[...o].splice(n,d);return t?(o.splice(n,d),o.splice(a,0,...m)):(o.splice(r+1,0,...m),o.splice(n,d)),o.join(`
`)})(t,n,r,o);c(((e,t,s,i,n,l)=>{let a=new Map(i),r=e.findIndex(e=>e.id===t),o=e[r];if(!o)return a;let d=[...e];d.splice(r,1);let m=d.findIndex(e=>e.id===s);d.splice(n?m:m+1,0,o);let c=i.get(l);if(!c)return a;if(c===e)a.set(l,d);else{let t=s=>{for(let i of s)i.children===e?i.children=d:i.children&&t(i.children)};t(c),a.set(l,c)}return a})(l,e.id,i.id,m,n,a)),s&&(await s(d),g(!1),f(i.id))},[u,t,m,c,s]),L=(0,l.useCallback)(async e=>{s&&(g(!0),await s(e),g(!1))},[s]);function T(e,s,r,m,c,g){let v=!e.isBullet&&!e.isNumbered,y="OL"===r.tagName?"ol":"UL"===r.tagName?"ul":"div";return(0,i.jsxs)(l.Fragment,{children:[v&&(0,i.jsx)(S,{toggledItem:x,setToggledItem:I,markdownValue:t,onChange:L,onConvertToIssue:n,onConvertToSubIssue:a,nested:c,position:s,item:e,totalItems:m,disabled:u||k,hideActions:!h&&!k,setitemIdToFocus:f,itemIdToFocus:p}),!v&&(0,i.jsx)(A,{item:e,position:s}),e.children.length>0&&(0,i.jsx)(o.BS,{items:e.children,onDrop:t=>b({...t,items:e.children,container:r}),renderOverlay:(t,n)=>(0,i.jsx)(o.BS.Item,{index:n,id:t.id,title:t.title,hideTrigger:!0,className:d["task-list-item"],isDragOverlay:!0,style:{marginLeft:"-30px"},children:T(t,s+1,r,e.children.length,!0,!0)},t.id),as:"div",children:(0,i.jsx)(y,{className:"base-list-item",style:{listStyleType:"none",marginLeft:v?"12px":"-28px"},children:e.children.map((t,n)=>{let l=M({child:t,position:s}),a=O({child:t,isDragOverlay:g}),d=E({child:t,isDragOverlay:g});return(0,i.jsx)(o.BS.Item,{index:n,id:t.id,title:t.title,hideTrigger:!0,className:`${l} ${a} ${d}`,as:U(e)?"li":"div",children:T(t,s+1,r,e.children.length,!0,g)},t.id)})})})]},e.index)}return(0,l.useMemo)(()=>(0,i.jsx)(i.Fragment,{children:e.map((e,t)=>{let s=m.get(e)||[],n=s.filter(e=>!e.isBullet&&!e.isNumbered),l="OL"===e.tagName?"ol":"UL"!==e.tagName||e.classList.contains("contains-task-list")&&n.length===s.length?"div":"ul";return s.length>0?(0,r.createPortal)((0,i.jsx)("li",{className:"base-task-list-item",style:{listStyle:"none",marginLeft:"-28px"},children:(0,i.jsx)(o.BS,{items:s,onDrop:t=>b({...t,items:s,container:e}),style:{marginTop:"1px"},renderOverlay:(t,n)=>(0,i.jsx)(o.BS.Item,{index:n,id:t.id,title:t.title,hideTrigger:!0,isDragOverlay:!0,children:T(t,0,e,s.length,!1,!0)},t.id),as:"div",children:(0,i.jsx)(l,{className:"base-list-item",style:{marginLeft:n.length!==s.length&&n.length?"5px":"0px"},children:s.map((t,n)=>(0,i.jsx)(o.BS.Item,{index:n,id:t.id,title:t.title,hideTrigger:!0,className:t.isBullet?d["bullet-task-item"]:t.isNumbered?d["numbered-task-item"]:d["task-list-item"],as:U(t)?"li":"div",style:{marginLeft:t.isBullet||t.isNumbered||!t.hasDifferentListTypes?"0px":"-28px",marginRight:"-8px"},children:T(t,0,e,s.length,!1,!1)},t.id))})})}),e,t.toString()):null})}),[t,m,u])},M=({child:e,position:t})=>e.isNumbered?t+1<2?d["numbered-task-list"]:d["numbered-task-list-nested"]:e.isBullet?t+1<2?d["unordered-task-list"]:d["unordered-task-list-nested"]:d["task-list-item"],O=({child:e,isDragOverlay:t})=>!e.isBullet&&!e.isNumbered&&(t?d["nested-overlay-list"]:e.parentIsChecklist||e.hasDifferentListTypes?"":d["task-list-item"]),E=({child:e,isDragOverlay:t})=>(e.isBullet||e.isNumbered)&&(t?d["overlay-task-list-child"]:""),U=e=>(e.isNumbered||e.isBullet)&&!e.hasDifferentListTypes||e.hasDifferentListTypes||e.children.length>0;try{B.displayName||(B.displayName="TaskListItems")}catch{}let V={spinner:"NewMarkdownViewer-module__spinner--yFr_i","safe-html-box":"NewMarkdownViewer-module__safe-html-box--dKCgP"};var q=s(34164),P=s(88431);let K=[],H=function(e,t,s){let[i,n]=(0,l.useState)([]);return(0,P.N)(()=>{let s=Array.from(e.current?.querySelectorAll(t)??K);n(e=>!function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}(e,s)?s:e)},[s,e,t]),i};var F=s(42931);let R=/\b(href|src)\s*=\s*(['"])([^'"?]{1,2000})(\?(?:[^'"]{0,1000}?))token=([^&#"']{0,500})([^'"]{0,1000})\2/gi,W=({verifiedHTML:e,markdownValue:t="",onChange:s,onConvertToIssue:r,onConvertToSubIssue:o,onLinkClick:d,openLinksInNewTab:m=!1,loading:c=!1,disabled:u,viewerCanUpdate:h,className:g})=>{let p=(0,l.useRef)(null),f=H(p,".contains-task-list:not(.contains-task-list .contains-task-list)",e),x=(0,l.useRef)(""),I=(0,l.useMemo)(()=>(function(e,t){R.lastIndex=0;let s=0;return e.replace(R,(e,i,n,l,a,r,o)=>{if(++s>1e3)return e;let d=`${l}${a}token=TOKEN_PLACEHOLDER${o}`;return t.hasOwnProperty(d)?`${i}=${n}${l}${a}token=${t[d]}${o}${n}`:e})})(e,function(e){let t,s={};R.lastIndex=0;let i=0;for(;null!==(t=R.exec(e))&&!(++i>1e3);){let e=t[3],i=t[4],n=t[5],l=t[6];e&&n&&(s[`${e}${i}token=TOKEN_PLACEHOLDER${l}`]=n)}return s}(x.current)),[e]);x.current=I;let{tasklistData:b,nestedItems:L,setTasklistData:T}=((e,t)=>{let[s,i]=(0,l.useState)(()=>new Map),[n,a]=(0,l.useState)(()=>new Map);return(0,P.N)(()=>{if(!e)return;let s=function({container:e,tasklists:t}){let s=new Map,i=new Map,n=function(e,t="ul:not(.base-list-item), ol:not(.base-list-item)"){return Array.from(e.querySelectorAll(t)).filter(e=>!e.closest("tracking-block"))}(e),l=0,a=-1;for(let r of t){let t=Array.from(r.querySelectorAll(":scope > li:not(.base-task-list-item)")),o=r.querySelectorAll(":scope > li.task-list-item"),d=[],{globalIndex:m,markdownIndex:c}=k({container:e,nestedItems:i,globalIndex:l,markdownIndex:a,items:t,itemsData:d,nested:!1,lists:n,parentIsChecklist:r.classList.contains("task-list-item"),hasDifferentListTypes:o.length>0&&o.length!==t.length});for(let e of(l=m,a=c,s.set(r,d),t))e.remove()}return{newData:s,nestedItems:i}}({container:e,tasklists:t});i(s.newData),a(s.nestedItems)},[e,t]),{tasklistData:s,nestedItems:n,setTasklistData:i,setNestedItems:a}})(p.current,f);(0,F.O)({htmlContainerRef:p,onLinkClick:d,openLinksInNewTab:m});let v=(0,l.useMemo)(()=>{let e=["markdown-body",V["safe-html-box"]];return g&&e.push(g),(0,i.jsx)(a.vb,{ref:p,className:(0,q.$)(e),html:I})},[g,I]);return c?(0,i.jsx)("div",{className:(0,q.$)(V.spinner),children:(0,i.jsx)(n.A,{"aria-label":"Loading markdown content..."})}):(0,i.jsxs)(i.Fragment,{children:[v,f.length>0&&(0,i.jsx)(B,{tasklists:f,markdownValue:t,externalOnChange:s,onConvertToIssue:r,onConvertToSubIssue:o,tasklistData:b,setTasklistData:T,nestedItems:L,disabled:u||!s,viewerCanUpdate:h})]})};try{W.displayName||(W.displayName="NewMarkdownViewer")}catch{}}}]);
//# sourceMappingURL=packages_markdown-viewer_NewMarkdownViewer_tsx-a2565495e8b1.js.map